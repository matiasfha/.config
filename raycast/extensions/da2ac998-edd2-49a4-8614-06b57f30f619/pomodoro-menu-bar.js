"use strict";var d=Object.defineProperty;var $=Object.getOwnPropertyDescriptor;var w=Object.getOwnPropertyNames;var J=Object.prototype.hasOwnProperty;var H=(t,e)=>{for(var r in e)d(t,r,{get:e[r],enumerable:!0})},U=(t,e,r,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let u of w(e))!J.call(t,u)&&u!==r&&d(t,u,{get:()=>e[u],enumerable:!(s=$(e,u))||s.enumerable});return t};var V=t=>U(d({},"__esModule",{value:!0}),t);var j={};H(j,{default:()=>F});module.exports=V(j);var o=require("@raycast/api"),D=require("react");var I="Focus",v="Short Break",g="Long Break";var a=require("@raycast/api");var i=new a.Cache,f="pomodoro-interval/1.1",h="pomodoro-interval/completed-pomodoro-count",C="pomodoro-interval/history",p=()=>Math.round(new Date().valueOf()/1e3);async function Y(){let t=await a.LocalStorage.getItem(C);return typeof t!="string"||t===null?[]:JSON.parse(t)}async function b(t){let e=await Y(),r=e.findIndex(s=>s.id===t.id);r!==-1?e[r]=t:e.push(t),await a.LocalStorage.setItem(C,JSON.stringify(e))}function x({parts:t}){return t.reduce((e,r)=>(typeof r.pausedAt<"u"?r.pausedAt-r.startedAt:p()-r.startedAt)+e,0)}function k(t){return x(t)/t.length*100}function S({parts:t}){return!!t[t.length-1].pausedAt}function T(t,e){let r=0;e||(r=parseInt(i.get(h)??"0",10),r++),i.set(h,r.toString());let s={type:t,id:r,length:K[t],parts:[{startedAt:p()}]};return i.set(f,JSON.stringify(s)),b(s).then(),s}function O(){let t=l();if(t){let e=[...t.parts];e[e.length-1].pausedAt=p(),t={...t,parts:e},i.set(f,JSON.stringify(t))}return t}function A(){let t=l();if(t){let e=[...t.parts,{startedAt:p()}];t={...t,parts:e},i.set(f,JSON.stringify(t))}return t}function B(){i.remove(f)}function E(){let t=l();if(t){let{type:e}=t;T(e,!1)}}function l(){let t=i.get(f);if(t)return JSON.parse(t)}function P(t){try{t.parts[t.parts.length-1].endAt=p(),b(t).then(),(0,a.launchCommand)({name:"pomodoro-control-timer",type:a.LaunchType.UserInitiated,context:{currentInterval:t}})}catch(e){console.error(e)}}var c=(0,a.getPreferenceValues)(),K={focus:parseInt(c.focusIntervalDuration)*60,"short-break":parseInt(c.shortBreakIntervalDuration)*60,"long-break":parseInt(c.longBreakIntervalDuration)*60};function R(t){if(t<=0)return"00:00";let e=Math.floor(t/60),r=t%60;return`${e<10?`0${e}`:e}:${r<10?`0${r}`:r}`}var n=require("react/jsx-runtime"),N={light:"#000000",dark:"#FFFFFF",adjustContrast:!1};function F(){let[t,e]=(0,D.useState)(l());t&&k(t)>=100&&P(t);function r(y){e(T(y))}function s(){e(O())}function u(){e(A())}function L(){B(),e(void 0)}function M(){E(),e(l())}let m;m={source:"tomato-0.png",tintColor:N},t&&(m={source:`tomato-${100-Math.floor(k(t)/10)*10}.png`,tintColor:N});let _=c.enableTimeOnMenuBar?t?R(t.length-x(t)):"--:--":void 0;return(0,n.jsx)(o.MenuBarExtra,{icon:m,title:_,tooltip:"Pomodoro",children:t?(0,n.jsxs)(n.Fragment,{children:[S(t)?(0,n.jsx)(o.MenuBarExtra.Item,{title:"Continue",icon:o.Icon.Play,onAction:u,shortcut:{modifiers:["cmd"],key:"c"}}):(0,n.jsx)(o.MenuBarExtra.Item,{title:"Pause",icon:o.Icon.Pause,onAction:s,shortcut:{modifiers:["cmd"],key:"p"}}),(0,n.jsx)(o.MenuBarExtra.Item,{title:"Reset",icon:o.Icon.Stop,onAction:L,shortcut:{modifiers:["cmd"],key:"r"}}),(0,n.jsx)(o.MenuBarExtra.Item,{title:"Restart Current",icon:o.Icon.Repeat,onAction:M,shortcut:{modifiers:["cmd"],key:"t"}})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(o.MenuBarExtra.Item,{title:I,subtitle:`${c.focusIntervalDuration}:00`,icon:"\u{1F3AF}",onAction:()=>r("focus"),shortcut:{modifiers:["cmd"],key:"f"}}),(0,n.jsx)(o.MenuBarExtra.Item,{title:v,subtitle:`${c.shortBreakIntervalDuration}:00`,icon:"\u{1F9D8}\u200D\u2642\uFE0F",onAction:()=>r("short-break"),shortcut:{modifiers:["cmd"],key:"s"}}),(0,n.jsx)(o.MenuBarExtra.Item,{title:g,subtitle:`${c.longBreakIntervalDuration}:00`,icon:"\u{1F6B6}",onAction:()=>r("long-break"),shortcut:{modifiers:["cmd"],key:"l"}})]})})}
